{"version":3,"sources":["felixhayashi/tiddlymap/js/edgeTypeSubscriber/TmapEdgeTypeSubscriber.js"],"names":["_utils","require","_Edge","_AbstractEdgeTypeSubscriber","TmapEdgeTypeSubscriber","allEdgeTypes","options","arguments","length","undefined","_classCallCheck","this","_possibleConstructorReturn","__proto__","Object","getPrototypeOf","call","_extends","priority","tObj","toWL","typeWL","connections","_utils2","default","parseFieldData","tById","tracker","getTiddlersByIds","fromId","fields","edges","makeHashMap","conId","con","toTRef","to","type","_Edge2","edge","id","genUUID","writeFieldData","$tm","config","sys","jsonIndentation","edgeType"],"mappings":"gjBAaA,IAAAA,QAAAC,QAAA,wFACA,IAAAC,OAAAD,QAAA,qFAAA,IAAAE,6BAAAF,QAAA;;;;;;;;;;GAWMG,kDAEJ,SAAAA,GAAYC,GAA4B,GAAdC,GAAcC,UAAAC,OAAA,GAAAD,UAAA,KAAAE,UAAAF,UAAA,KAAAG,iBAAAC,KAAAP,EAAA,OAAAQ,4BAAAD,MAAAP,EAAAS,WAAAC,OAAAC,eAAAX,IAAAY,KAAAL,KAChCN,EADgCY,UAChBC,SAAU,GAAMZ,uDAM9Ba,EAAMC,EAAMC,GAEpB,GAAMC,GAAcC,QAAAC,QAAMC,eAAeN,EAAM,aAC/C,KAAKG,EAAa,CAChB,OAGF,GAAMI,GAAQf,KAAKgB,QAAQC,kBAxB/B,IAAAC,GAAAV,EAAAW,OAAA,UAEA,IAAAC,GAAAR,QAAAC,QAAAQ,aA2BI,KAAK,GAAIC,KAASX,GAAa,CAE7B,GAAMY,GAAMZ,EAAYW,EACxB,IAAME,GAAST,EAAMQ,EAAIE,GAxBzBhC,IAAAA,KAAAA,GAyBwBgB,EAAKe,OAAcd,GAAUA,EAAOa,EAAIG,OAAQ,CAEtEN,EAAME,GAAS,GAAAK,QAAAd,QAASK,EAAQK,EAAIE,GAAIF,EAAIG,KAAMJ,IAzBhB,MAAAF,wCAoC7BZ,EAAMoB,EAAMF,GAGrB,GAAIf,GAAcC,QAAAC,QAAMC,eAAeN,EAAM,gBAG7CoB,GAAKC,GAAKD,EAAKC,IAAMjB,QAAAC,QAAMiB,SAhC3BnB,GAAKA,EAAAA,KAAac,GAAAG,EAAAH,GAAAC,KAAAA,EAAAG,GAqClBjB,SAAAC,QAAMkB,eAAevB,EAAM,aAAcG,EAAaqB,IAAIC,OAAOC,IAAIC,gBAhCrE,OAAMjB,wCAOEM,EAAAA,EAAST,GAoCjB,IAAKa,EAAKC,GAAI,MA/Bb,IAAAlB,GAAAC,QAAAC,QAAAC,eAAAN,EAAA,uBAIFG,GAAAiB,EAAAC,GAoCCjB,SAAAC,QAAMkB,eAAevB,EAAM,aAAcG,EAAaqB,IAAIC,OAAOC,IAAIC,gBAErE,OAAOP,uCAOCQ,GAlCRR,MAAKC,kEAOLpC,uBAAAA","file":"../../../../../felixhayashi/tiddlymap/js/edgeTypeSubscriber/TmapEdgeTypeSubscriber.js","sourcesContent":["// @preserve\n/*\\\n\ntitle: $:/plugins/felixhayashi/tiddlymap/js/modules/edge-type-handler/tmap\ntype: application/javascript\nmodule-type: tmap.edgetypehandler\n\n@preserve\n\n\\*/\n\n/*** Imports *******************************************************/\n\nimport utils from '$:/plugins/felixhayashi/tiddlymap/js/utils';\nimport Edge from '$:/plugins/felixhayashi/tiddlymap/js/Edge';\nimport AbstractEdgeTypeSubscriber from '$:/plugins/felixhayashi/tiddlymap/js/AbstractEdgeTypeSubscriber';\n\n/*** Code **********************************************************/\n\n/**\n * TiddlyMap's original EdgeTypeSubscriber. It will store and retrieve edges by relying on\n * json stored in a tiddler field.\n *\n * @constructor\n */\nclass TmapEdgeTypeSubscriber extends AbstractEdgeTypeSubscriber {\n\n  constructor(allEdgeTypes, options = {}) {\n    super(allEdgeTypes, { priority: 0, ...options });\n  }\n\n  /**\n   * @inheritDoc\n   */\n  loadEdges(tObj, toWL, typeWL) {\n\n    const connections = utils.parseFieldData(tObj, 'tmap.edges');\n    if (!connections) {\n      return;\n    }\n\n    const tById = this.tracker.getTiddlersByIds();\n    const fromId = tObj.fields['tmap.id'];\n\n    const edges = utils.makeHashMap();\n\n    for (let conId in connections) {\n\n      const con = connections[conId];\n      const toTRef = tById[con.to];\n      if (toTRef && (!toWL || toWL[toTRef]) && (!typeWL || typeWL[con.type])) {\n\n        edges[conId] = new Edge(fromId, con.to, con.type, conId);\n      }\n    }\n\n    return edges;\n\n  }\n\n  /**\n   * @inheritDoc\n   */\n  insertEdge(tObj, edge, type) {\n\n    // load existing connections\n    var connections = utils.parseFieldData(tObj, 'tmap.edges', {});\n\n    // assign new id if not present yet\n    edge.id = edge.id || utils.genUUID();\n    // add to connections object\n    connections[edge.id] = {to: edge.to, type: type.id};\n\n    // save\n    utils.writeFieldData(tObj, 'tmap.edges', connections, $tm.config.sys.jsonIndentation);\n\n    return edge;\n\n  }\n\n  /**\n   * @inheritDoc\n   */\n  deleteEdge (tObj, edge, type) {\n\n    if (!edge.id) return;\n\n    // load\n    var connections = utils.parseFieldData(tObj, 'tmap.edges', {});\n\n    // delete\n    delete connections[edge.id];\n\n    // save\n    utils.writeFieldData(tObj, 'tmap.edges', connections, $tm.config.sys.jsonIndentation);\n\n    return edge;\n\n  }\n\n  /**\n   * @inheritDoc\n   */\n  canHandle(edgeType) {\n\n    return true;\n\n  }\n}\n\n/*** Exports *******************************************************/\n\nexport { TmapEdgeTypeSubscriber };\n"],"sourceRoot":"../../../../../../src/plugins"}